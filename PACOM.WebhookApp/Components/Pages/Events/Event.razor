@page "/Events/Event"
@using MudBlazor
@using System.Globalization

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pa-6">

    <MudText Typo="Typo.h4" Class="mb-4">Event</MudText>

    <MudGrid Class="mb-4" Spacing="2">
        <MudItem xs="3">
            <MudTextField @bind-Value="startDate" Label="Start Date" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.CalendarToday" />
        </MudItem>
        <MudItem xs="3">
            <MudTextField @bind-Value="endDate" Label="End Date" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.CalendarToday" />
        </MudItem>
        <MudItem xs="3">
            <MudSelect @bind-Value="selectedAgency" Label="Jabatan/Agensi" FullWidth="true">
                @* Add MudSelectItem components here for options *@
            </MudSelect>
        </MudItem>
        <MudItem xs="3" Class="d-flex align-center">
            <MudButton OnClick="SearchData" Variant="Variant.Filled" Color="Color.Success" Class="mr-2" Style="height:56px;">Search</MudButton>
        </MudItem>
    </MudGrid>

    <div class="d-flex mb-4">
        <MudButton OnClick="ExportToExcel" Variant="Variant.Filled" Color="Color.Success" Class="mr-2">Excel</MudButton>
        <MudButton OnClick="ExportToPdf" Variant="Variant.Filled" Color="Color.Error">PDF</MudButton>
    </div>

    <MudTable Items="@EventLogs" Hover="true" Breakpoint="Breakpoint.Sm" T="EventLog" Elevation="0" Bordered="true">

        <HeaderContent>
            <MudTh Style="width:15%;">Datetime</MudTh>
            <MudTh Style="width:25%;">Event Type</MudTh>
            <MudTh Style="width:20%;">Reader</MudTh>
            <MudTh Style="width:15%;">Cardholder Name</MudTh>
            <MudTh Style="width:15%;">Jabatan/Agensi</MudTh>
            <MudTh Style="width:10%;">Card.No</MudTh>
        </HeaderContent>

        <RowTemplate>
            <MudTd DataLabel="Datetime">@context.Datetime.ToString("yyyy-MM-dd HH:mm:ss")</MudTd>
            <MudTd DataLabel="Event Type">@context.EventType</MudTd>
            <MudTd DataLabel="Reader">@context.Reader</MudTd>
            <MudTd DataLabel="Cardholder Name">@context.CardholderName</MudTd>
            <MudTd DataLabel="Jabatan/Agensi">@context.Agency</MudTd>
            <MudTd DataLabel="Card.No">@context.CardNo</MudTd>
        </RowTemplate>

        <NoRecordsContent>
            <MudText>No event logs found.</MudText>
        </NoRecordsContent>
    </MudTable>

</MudContainer>

@code {
    // --- Data Model ---
    public class EventLog
    {
        public DateTime Datetime { get; set; }
        public string EventType { get; set; } = string.Empty;
        public string Reader { get; set; } = string.Empty;
        public string CardholderName { get; set; } = string.Empty;
        public string Agency { get; set; } = string.Empty;
        public string CardNo { get; set; } = string.Empty;
    }

    // --- Component State and Properties ---
    private string startDate;
    private string endDate;
    private string selectedAgency;

    private List<EventLog> EventLogs = new List<EventLog>();

    // --- Methods ---

    protected override void OnInitialized()
    {
        EventLogs = GetSampleData();
    }

    private List<EventLog> GetSampleData()
    {
        return new List<EventLog>
        {
            new EventLog {
                Datetime = DateTime.ParseExact("2025-11-04 23:39:48", "yyyy-MM-dd HH:mm:ss", CultureInfo.InvariantCulture),
                EventType = "SPG.S1000.Event.AccessGrantedEvent",
                Reader = "C2-B1-2-R1-TO LOADING BAY-IN",
                CardholderName = "ADILIA NATHRAH",
                Agency = "Jabatan Perkhidmatan Awam",
                CardNo = "78023418"
            },
            new EventLog {
                Datetime = DateTime.ParseExact("2025-11-04 23:39:41", "yyyy-MM-dd HH:mm:ss", CultureInfo.InvariantCulture),
                EventType = "SPG.S1000.Event.AccessTakenEvent",
                Reader = "C2-B1-2-R1-TO LOADING BAY-IN",
                CardholderName = "ADILIA NATHRAH",
                Agency = "Jabatan Perkhidmatan Awam",
                CardNo = "78023418"
            },
            new EventLog {
                Datetime = DateTime.ParseExact("2025-11-04 23:32:50", "yyyy-MM-dd HH:mm:ss", CultureInfo.InvariantCulture),
                EventType = "SPG.S1000.Event.AccessGrantedEvent",
                Reader = "C1-L1-3-R1-FIRE EXIT DOOR 2-RIGHT-IN",
                CardholderName = "MOHAMAD HELMY",
                Agency = "Jabatan Perkhidmatan Awam",
                CardNo = "03460430"
            }
        };
    }

    private void SearchData()
    {
        // Implementation for searching/filtering data
    }

    private void ExportToExcel()
    {
        // Implementation for exporting to Excel
    }

    private void ExportToPdf()
    {
        // Implementation for exporting to PDF
    }
}